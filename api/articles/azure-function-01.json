{"title":"Azure Function .Net Core 開發紀錄（一）","uid":"0208fe8c6452beee2ecaf0f83aa5c3da","slug":"azure-function-01","date":"2021-09-25T06:00:00.000Z","updated":"2022-08-19T01:08:59.331Z","comments":true,"path":"api/articles/azure-function-01.json","keywords":null,"cover":[],"content":"<h1 id=\"Azure-Function-Net-Core-開發紀錄（一）-如何進行-Dependency-Injection\"><a href=\"#Azure-Function-Net-Core-開發紀錄（一）-如何進行-Dependency-Injection\" class=\"headerlink\" title=\"Azure Function .Net Core 開發紀錄（一） 如何進行 Dependency Injection\"></a>Azure Function .Net Core 開發紀錄（一） 如何進行 Dependency Injection</h1><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在 Visual Studio 建立新的 Azure Function 的專案的時候，預設是不會有 Dependency Inejction 的相關設定，但是可以透過安裝 nuget 套件來進行設定。</p>\n<h2 id=\"安裝套件\"><a href=\"#安裝套件\" class=\"headerlink\" title=\"安裝套件\"></a>安裝套件</h2><h3 id=\"安裝-Microosft-Azure-Functions-Extensions-套件\"><a href=\"#安裝-Microosft-Azure-Functions-Extensions-套件\" class=\"headerlink\" title=\"安裝 Microosft.Azure.Functions.Extensions 套件\"></a>安裝 Microosft.Azure.Functions.Extensions 套件</h3><p><img src=\"https://i.imgur.com/DY8Tf5u.png\"></p>\n<h2 id=\"設定-Startup\"><a href=\"#設定-Startup\" class=\"headerlink\" title=\"設定 Startup\"></a>設定 Startup</h2><p>與 .net core API 專案的 Template 不同， Azure Function 的專案預設是不會建立 Startup ，所以需要自行建立入口的 class。</p>\n<pre class=\"line-numbers language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\"><span class=\"token comment\">// Startup.cs</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Azure<span class=\"token punctuation\">.</span>Functions<span class=\"token punctuation\">.</span>Extensions<span class=\"token punctuation\">.</span>DependencyInjection</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Extensions<span class=\"token punctuation\">.</span>DependencyInjection</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token target keyword\">assembly</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">FunctionsStartup</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span><span class=\"token type-expression class-name\">MyNamespace<span class=\"token punctuation\">.</span>Startup</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">MyNamespace</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Startup</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">FunctionsStartup</span></span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IFunctionsHostBuilder</span> builder<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#123;</span>\n            builder<span class=\"token punctuation\">.</span>Services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSingleton</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>ILoggerProvider<span class=\"token punctuation\">,</span> MyLoggerProvider<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"注意事項\"><a href=\"#注意事項\" class=\"headerlink\" title=\"注意事項\"></a>注意事項</h2><p>Azure Function 預設的 template 提供的 function 會掛 static 修飾詞，要記得拔掉，否則無法取得 DI 的物件。</p>\n<h2 id=\"參考\"><a href=\"#參考\" class=\"headerlink\" title=\"參考\"></a>參考</h2><p><a href=\"https://docs.microsoft.com/zh-tw/azure/azure-functions/functions-dotnet-dependency-injection\">https://docs.microsoft.com/zh-tw/azure/azure-functions/functions-dotnet-dependency-injection</a></p>\n","text":"Azure Function .Net Core 開發紀錄（一） 如何進行 Dependency Injection前言在 Visual Studio 建立新的 Azure Function 的專案的時候，預設是不會有 Dependency Inejction 的相關設定，但是可...","link":"","photos":[],"count_time":{"symbolsCount":952,"symbolsTime":"1 mins."},"categories":[{"name":"程式開發","slug":"程式開發","count":5,"path":"api/categories/程式開發.json"}],"tags":[{"name":"Azure","slug":"Azure","count":2,"path":"api/tags/Azure.json"},{"name":"Azure Function","slug":"Azure-Function","count":2,"path":"api/tags/Azure-Function.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Azure-Function-Net-Core-%E9%96%8B%E7%99%BC%E7%B4%80%E9%8C%84%EF%BC%88%E4%B8%80%EF%BC%89-%E5%A6%82%E4%BD%95%E9%80%B2%E8%A1%8C-Dependency-Injection\"><span class=\"toc-text\">Azure Function .Net Core 開發紀錄（一） 如何進行 Dependency Injection</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%9D%E5%A5%97%E4%BB%B6\"><span class=\"toc-text\">安裝套件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%9D-Microosft-Azure-Functions-Extensions-%E5%A5%97%E4%BB%B6\"><span class=\"toc-text\">安裝 Microosft.Azure.Functions.Extensions 套件</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A8%AD%E5%AE%9A-Startup\"><span class=\"toc-text\">設定 Startup</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85\"><span class=\"toc-text\">注意事項</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%83%E8%80%83\"><span class=\"toc-text\">參考</span></a></li></ol></li></ol>","author":{"name":"MurabitoB","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/22661940?s=460&u=4cab0880b99fcb3784e73bc6550039106c2ba83e&v=4","link":"/","description":"後端軟體工程師<br>業餘Unity工程師<br>獨立遊戲開發","socials":{"github":"https://github.com/MurabitoB","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"linkedin":{"icon":"fab fa-linkedin","link":"https://www.linkedin.com/in/kai-sheng-liu-b209781b4/"}}}},"mapped":true,"prev_post":{"title":"Azure Function .Net Core 開發紀錄（二）","uid":"8dcfbec48199ae555ff114e052c8f13f","slug":"azure-function-02","date":"2021-09-25T08:00:00.000Z","updated":"2022-08-19T01:08:59.331Z","comments":true,"path":"api/articles/azure-function-02.json","keywords":null,"cover":null,"text":"Azure Function .Net Core 開發紀錄（二） 如何取得 config 變數前言在 .Net Core API 專案中，我們習慣透過 appsetting.json 來取得 config 的設定值，在 Azure function 中，需要透過專案根目錄裡面的 ...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"程式開發","slug":"程式開發","count":5,"path":"api/categories/程式開發.json"}],"tags":[{"name":"Azure","slug":"Azure","count":2,"path":"api/tags/Azure.json"},{"name":"Azure Function","slug":"Azure-Function","count":2,"path":"api/tags/Azure-Function.json"}],"author":{"name":"MurabitoB","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/22661940?s=460&u=4cab0880b99fcb3784e73bc6550039106c2ba83e&v=4","link":"/","description":"後端軟體工程師<br>業餘Unity工程師<br>獨立遊戲開發","socials":{"github":"https://github.com/MurabitoB","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"linkedin":{"icon":"fab fa-linkedin","link":"https://www.linkedin.com/in/kai-sheng-liu-b209781b4/"}}}},"feature":true},"next_post":{"title":".Net Core Dependency Injection Scoped 注入到 Singleton","uid":"98c01dec7a830e04805e721a8c540f17","slug":"dotnet-core-scoped-in-singleton","date":"2021-06-16T16:00:00.000Z","updated":"2022-08-19T01:08:59.331Z","comments":true,"path":"api/articles/dotnet-core-scoped-in-singleton.json","keywords":null,"cover":null,"text":"環境 .Net Core 3.1 問題踩雷． 在專案中如果想對 Singleton 的 Service 中直接注入 Scoped 的 Service 的話，會拋出 Exception 下面範例取自黑暗執行緒 System.AggregateException: 'Some ser...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"程式開發","slug":"程式開發","count":5,"path":"api/categories/程式開發.json"}],"tags":[{"name":".Net Core","slug":"Net-Core","count":1,"path":"api/tags/Net-Core.json"},{"name":"Dependency Injection","slug":"Dependency-Injection","count":1,"path":"api/tags/Dependency-Injection.json"}],"author":{"name":"MurabitoB","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/22661940?s=460&u=4cab0880b99fcb3784e73bc6550039106c2ba83e&v=4","link":"/","description":"後端軟體工程師<br>業餘Unity工程師<br>獨立遊戲開發","socials":{"github":"https://github.com/MurabitoB","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"linkedin":{"icon":"fab fa-linkedin","link":"https://www.linkedin.com/in/kai-sheng-liu-b209781b4/"}}}}}}