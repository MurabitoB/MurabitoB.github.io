{"title":"Azure Function .Net Core 開發紀錄（二）","uid":"8dcfbec48199ae555ff114e052c8f13f","slug":"azure-function-02","date":"2021-09-25T08:00:00.000Z","updated":"2022-08-19T01:08:59.331Z","comments":true,"path":"api/articles/azure-function-02.json","keywords":null,"cover":null,"content":"<h1 id=\"Azure-Function-Net-Core-開發紀錄（二）-如何取得-config-變數\"><a href=\"#Azure-Function-Net-Core-開發紀錄（二）-如何取得-config-變數\" class=\"headerlink\" title=\"Azure Function .Net Core 開發紀錄（二） 如何取得 config 變數\"></a>Azure Function .Net Core 開發紀錄（二） 如何取得 config 變數</h1><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在 .Net Core API 專案中，我們習慣透過 appsetting.json 來取得 config 的設定值，在 Azure function 中，需要透過專案根目錄裡面的 local.setting.json 的 Values 欄位來設定。</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">\"IsEncrypted\"</span><span class=\"token operator\">:</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Values\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token property\">\"AzureWebJobsStorage\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"UseDevelopmentStorage=true\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"FUNCTIONS_WORKER_RUNTIME\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"dotnet\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 從下面開始添加自己的設定</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>與 appsetting.json 不同， Values 裡面的變數不能再包成 json ，而是只能以 Key Value 的形式存在。</p></blockquote>\n<p>如果需要以物件形式存在，則必須填寫成 “&lt;物件名稱&gt;:&lt;變數名稱&gt;”:”變數值” 的形式。</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">\"IsEncrypted\"</span><span class=\"token operator\">:</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Values\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token property\">\"AzureWebJobsStorage\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"UseDevelopmentStorage=true\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"FUNCTIONS_WORKER_RUNTIME\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"dotnet\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 自訂變數</span>\n        <span class=\"token property\">\"UserInfo:Name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"MurabitoB\"</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"在程式端取得環境變數\"><a href=\"#在程式端取得環境變數\" class=\"headerlink\" title=\"在程式端取得環境變數\"></a>在程式端取得環境變數</h2><p>在程式端可以透過下列的方法取得 config 的值</p>\n<ol>\n<li>System.Environment.GetEnvironmentVariable</li>\n<li>透過 Dependency Inejction + IOption Pattern 來取得環境變數</li>\n</ol>\n<p>在這篇文章我只打算介紹第二種方法，因為使用強型別的物件相對於前者要來的可靠的多。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>DI 的設定可以參考 <a href=\"https://murabitob.github.io/post/azure-function-01\">上篇文章</a></p></blockquote>\n<hr>\n<p>設定要綁定的 Model</p>\n<pre class=\"line-numbers language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserInfo</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> Name <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>               <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<p>在 IFunctionsHostBuilder 裡面設定 IOptionPattern</p>\n<pre class=\"line-numbers language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IFunctionsHostBuilder</span> builder<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#123;</span>\n    builder<span class=\"token punctuation\">.</span>Services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddOptions</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>UserInfo<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Configure</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IConfiguration<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">,</span> configuration<span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>\n                    <span class=\"token punctuation\">&#123;</span>\n                        configufration<span class=\"token punctuation\">.</span><span class=\"token function\">GetSection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UserInfo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Bind</span><span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>接著再透過 DI 取得 IOption 物件</p>\n<pre class=\"line-numbers language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> UserService\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token function\">UserService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IOptions<span class=\"token punctuation\">&lt;</span>UserInfo<span class=\"token punctuation\">></span></span> userInfo<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> name <span class=\"token operator\">=</span> userInfo<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">;</span> <span class=\"token comment\">// MurabitoB</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n","feature":true,"text":"Azure Function .Net Core 開發紀錄（二） 如何取得 config 變數前言在 .Net Core API 專案中，我們習慣透過 appsetting.json 來取得 config 的設定值，在 Azure function 中，需要透過專案根目錄裡面的 ...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"程式開發","slug":"程式開發","count":5,"path":"api/categories/程式開發.json"}],"tags":[{"name":"Azure","slug":"Azure","count":2,"path":"api/tags/Azure.json"},{"name":"Azure Function","slug":"Azure-Function","count":2,"path":"api/tags/Azure-Function.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Azure-Function-Net-Core-%E9%96%8B%E7%99%BC%E7%B4%80%E9%8C%84%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%A6%82%E4%BD%95%E5%8F%96%E5%BE%97-config-%E8%AE%8A%E6%95%B8\"><span class=\"toc-text\">Azure Function .Net Core 開發紀錄（二） 如何取得 config 變數</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E7%A8%8B%E5%BC%8F%E7%AB%AF%E5%8F%96%E5%BE%97%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8\"><span class=\"toc-text\">在程式端取得環境變數</span></a></li></ol></li></ol>","author":{"name":"MurabitoB","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/22661940?s=460&u=4cab0880b99fcb3784e73bc6550039106c2ba83e&v=4","link":"/","description":"後端軟體工程師<br>業餘Unity工程師<br>獨立遊戲開發","socials":{"github":"https://github.com/MurabitoB","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"linkedin":{"icon":"fab fa-linkedin","link":"https://www.linkedin.com/in/kai-sheng-liu-b209781b4/"}}}},"mapped":true,"prev_post":{"title":"開發工具清單","uid":"5f1247cee4121beec31eab4f87c046c3","slug":"toolkit","date":"2022-09-13T06:00:00.000Z","updated":"2022-09-13T07:04:09.456Z","comments":true,"path":"api/articles/toolkit.json","keywords":null,"cover":null,"text":"個人常用開發工具及參考文章前言這裡主要條列一些常用開發的工具及 SDk 以便之後要換電腦的時候快速索引。 版本控制 Git IDE / 文字編輯器 Jetbrain - Rider Visual Studio Code 容器化 Docker kubectl k8sLens 雲端 ...","link":"","photos":[],"count_time":{"symbolsCount":292,"symbolsTime":"1 mins."},"categories":[{"name":"程式開發","slug":"程式開發","count":5,"path":"api/categories/程式開發.json"}],"tags":[{"name":"開發工具","slug":"開發工具","count":1,"path":"api/tags/開發工具.json"}],"author":{"name":"MurabitoB","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/22661940?s=460&u=4cab0880b99fcb3784e73bc6550039106c2ba83e&v=4","link":"/","description":"後端軟體工程師<br>業餘Unity工程師<br>獨立遊戲開發","socials":{"github":"https://github.com/MurabitoB","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"linkedin":{"icon":"fab fa-linkedin","link":"https://www.linkedin.com/in/kai-sheng-liu-b209781b4/"}}}},"feature":true},"next_post":{"title":"Azure Function .Net Core 開發紀錄（一）","uid":"0208fe8c6452beee2ecaf0f83aa5c3da","slug":"azure-function-01","date":"2021-09-25T06:00:00.000Z","updated":"2022-08-19T01:08:59.331Z","comments":true,"path":"api/articles/azure-function-01.json","keywords":null,"cover":[],"text":"Azure Function .Net Core 開發紀錄（一） 如何進行 Dependency Injection前言在 Visual Studio 建立新的 Azure Function 的專案的時候，預設是不會有 Dependency Inejction 的相關設定，但是可...","link":"","photos":[],"count_time":{"symbolsCount":952,"symbolsTime":"1 mins."},"categories":[{"name":"程式開發","slug":"程式開發","count":5,"path":"api/categories/程式開發.json"}],"tags":[{"name":"Azure","slug":"Azure","count":2,"path":"api/tags/Azure.json"},{"name":"Azure Function","slug":"Azure-Function","count":2,"path":"api/tags/Azure-Function.json"}],"author":{"name":"MurabitoB","slug":"blog-author","avatar":"https://avatars1.githubusercontent.com/u/22661940?s=460&u=4cab0880b99fcb3784e73bc6550039106c2ba83e&v=4","link":"/","description":"後端軟體工程師<br>業餘Unity工程師<br>獨立遊戲開發","socials":{"github":"https://github.com/MurabitoB","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"linkedin":{"icon":"fab fa-linkedin","link":"https://www.linkedin.com/in/kai-sheng-liu-b209781b4/"}}}},"feature":true}}